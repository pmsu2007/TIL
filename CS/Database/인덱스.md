# 인덱스 (Index)

인덱스는 추가적인 쓰기 작업과 저장 공간을 활용하여 **데이터베이스 테이블의 검색 속도를 향상시키기 위한 자료구조**이다.

테이블의 모든 데이터를 검색하면 시간이 오래걸리기 때문에 데이터와 데이터의 위치를 포함한 자료구조인 인덱스를 생성하여 빠르게 조회할 수 있도록 한다.

### 인덱스의 관리

DBMS는 인덱스를 항상 최신의 정렬 상태로 유지해야만 원하는 값을 빠르게 탐색할 수 있다.

그렇기 때문에 인덱스가 적용된 컬럼에 INSERT, UPDATE, DELETE가 수행된다면 추가적인 연산을 해주어야 한다. → 오버헤드 발생

만약, INSERT, UPDATE, DELETE가 빈번한 속성에 인덱스를 걸게 되면 **인덱스의 크기가 비대해져서 성능이 오히려 저하되는 역효과가 발생**한다.

왜냐하면 UPDATE와 DELETE는 기존의 인덱스를 삭제하는 것이 아니라 '사용하지 않음'처리를 하기 때문에 실제 데이터 양보다 인덱스가 비대해져 SQL문 처리 시 오히려 성능이 떨어지게 된다.

## 인덱스의 자료구조

### 해시 테이블 (Hash Table)

<p align="center">
    <img src=https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FRpMoO%2FbtqKMzdg9TX%2FXYkGt2kqE0hr9rqhHx3o3K%2Fimg.png>
</p>

해시 테이블은 Key-Value의 형태로 데이터를 저장하는 자료구조로, 빠른 데이터 검색이 필요할 때 유용하다.

해시 테이블 기반의 DB 인덱스는 (데이터, 데이터의 위치)의 형태와 같이 데이터로 생성된 해시를 통해 인덱스를 구현한다.

하지만 DB 인덱스에서 해시 테이블이 사용되는 경우는 제한적이다. 그 이유는 해시가 등호(`=`)연산에만 특화되어있기 때문이다.

부등호(`<`, `>`) 연산이 자주 사용되는 데이터베이스 검색 특성 상 해시 테이블은 인덱스로써 적합하지 않다.

### B-Tree 인덱스

<p align="center">
    <img src=https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fdjhlni%2FbtrXnJAFNh0%2FmdqodQkO6khsmi3Z8seFQ1%2Fimg.png>
</p>

### B-Tree
B-Tree는 자식을 2개만 갖는 이진 트리(Binary Tree)를 확장하여 **N개의 자식을 가질 수 있고 하나의 노드에 여러 개의 값을 가질 수 있다.**
 
또한, B-Tree는 좌우 균형이 맞지 않으면 비효율적으로 동작하기 때문에 항상 균형을 유지하고 있으며, 각 노드 내의 데이터들은 항상 정렬된 상태를 유지한다.

B-Tree의 최상단 노드를 루트 노드(Root Node), 최하위 노드를 리프 노드(Leaf Node), 중간에 있는 노드를 브랜치 노드(Branch Node)라고 한다.

#### 인덱스가 효율적인 이유

인덱스가 효율적인 이유는 균형 잡힌 트리 구조와 트리 깊이의 대수확장성 때문이다.

대수확장성은 트리 깊이가 **리프 노드 수에 비해 매우 느리게 성장**하는 것을 의미한다. 기본적으로 트리가 한 깊이씩 증가할 때마다 최대 인덱스 항목의 수는 4배씩 증가한다.

즉, 트리의 깊이가 10이라면 100만 개의 레코드를 10번만에 찾을 수 있으므로 매우 효율적이라고 할 수 있다.

### B+Tree

B+Tree는 DB 인덱스를 위해 B-Tree를 개선한 자료구조이며, 다음과 같은 특성을 갖고 있다. 

- 리프 노드만 데이터(Value)를 가지고 있으며, 나머지 노드는 데이터를 위한 인덱스(Key)만을 갖는다.
  
- 나머지 노드는 데이터(Value)를 저장하지 않기 때문에 남는 공간에 인덱스(Key) 값을 채워넣다 보니 트리의 높이를 낮출 수 있다.

- 리프 노드들은 연결 리스트(Linked List)로 연결되어 있다.

- 데이터 노드의 크기는 인덱스 노드의 크기와 같지 않아도 된다.

데이터베이스의 인덱스 컬럼은 부등호를 이용한 순차 검색 연산이 자주 발생될 수 있다. 이러한 이유로 **B-Tree의 리프노드를 연결 리스트로 연결하여 순차검색을 용이하게**하였다.



