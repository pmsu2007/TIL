# 공유 자원과 임게 영역 

## 공유 자원 (Shared Resource)

공유 자원은 시스템 안에서 **각 프로세스, 스레드가 함께 접근할 수 있는 모니터, 프린터, 메모리, 파일, 데이터 등의 자원이나 변수** 등을 의미한다.

### 경쟁 상태 (Race Condition)

경쟁 상태는 공유 자원을 두 개 이상의 프로세스가 동시에 읽거나 쓰는 상황을 말한다.

즉, 공유 자원에 동시에 접근을 시도할 때 접근의 타이밍이나 순서 등이 **결과값에 영향을 줄 수 있는 상태**이다.

## 임계 영역 (Critical Section) 

임계 영역은 둘 이상의 프로세스, 스레드가 공유 자원에 접근할 때 순서 등의 이유로 결과가 달라지는 코드 영역이다.

### 임계 영역 문제를 해결하기 위한 조건

- **상호 배제** 
  
  한 프로세스가 임계 구역에 들어가면 다른 프로세스는 들어갈 수 없다.
  
- **한정 대기**  
  
  특정 프로세스가 영원히 임계 영역에 들어가지 못하면 안된다.
  
- **융통성** 
  
  만약 어떠한 프로세스도 임계 영역을 사용하지 않는다면 임계 영역 외부의 어떠한 프로세스도 들어갈 수 있고 이 때 프로세스끼리 서로 방해하지 않는다.

### 임계 영역 문제 해결 방법

임계 영역을 해결하기 위한 방법은 크게 `뮤텍스`, `세마포어`, `모니터` 세 가지가 있으며, 위의 임계 영역 해결의 조건을 모두 만족한다.

#### 뮤텍스 (mutex)

뮤텍스는 공유 자원에 대한 접근을 동기화하기 위해 사용되는 상호 배제 기술이다.

뮤텍스는 프로세스나 스레드가 소유할 수 있고, 공유 자원을 `lock()`을 통해 잠금 설정하고 사용한 후에는 `unlock()`을 통해 잠금 해제하는 객체이다.

잠금이 설정되면 다른 프로세스나 스레드는 잠긴 코드 영역에 접근할 수 없다.

#### 세마포어 (semaphore)

세마포어는 접근 가능한 공유 자원을 나타내는 변수와 두 가지 함수 `wait`(P 함수) 및 `signal`(V 함수)로 공유 자원에 대한 접근을 처리한다.

여기서 `wait()`은 자신의 차례가 올 때까지 기다리는 함수이며, `signal()`은 다음 프로세서로 순서를 넘겨주는 함수이다.

- **바이너리 세마포어 (Binary Semaphore)**
  
  바이너리 세마포어는 0과 1의 두가지 값만 가질 수 있는 세마포어이다.

  구현의 유사성으로 인해 뮤텍스는 바이너리 세마포어라고 할 수 있지만, 뮤텍스는 잠금을 기반으로 상호배제가 일어나는 '잠금 매커니즘'이고, 세마포어는 신호를 기반으로 상호 배제가 일어나는 '신호 매커니즘'이라는 차이가 있다.

- **카운팅 세마포어 (Counting Semaphore)**
  
  카운팅 세마포어는 여러 개의 값을 가질 수 있는 세마포어이며, 여러 자원에 대한 접근을 제어하는 데 사용한다.

#### 뮤텍스와 세마포어의 차이

- 뮤텍스는 동기화 대상이 오직 1개일 때 사용하고, 세마포어는 동기화 대상이 1개 이상일 때 사용한다.

- 0과 1로 이루어진 바이너리 세마포어는 뮤텍스가 될 수 있으나, 뮤텍스는 세마포어가 될 수 없다.

- 세마포어는 소유할 수 없으며, 뮤텍스는 소유할 수 있고 그에 대한 책임을 가진다.
