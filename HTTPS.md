# HTTPS

![alt text](https://i.imgur.com/4GHgl0T.png)

> ### HTTP (HyperText Transfer Protocol)
>
> HTTP는 하이퍼텍스트(HyperText)를 전송(Transfer)하기 위해 사용되는 통신 규약(Protocol)이다.
>
> 즉, 인터넷 상에서 HTML과 같은 문서를 웹 브라우저가 웹 서버에게 요청할 때 사용하는 규칙이라고 할 수 있다. <br/> > <br/>

HTTP는 정보를 텍스트로 주고 받기 때문에 네트워크에서 이를 가로채는 경우 데이터 유출의 위험이 있다. 이러한 **보안 취약점을 해결하기 위한 프로토콜이 HTTPS이다.**

즉, HTTPS를 사용하면 <u>**서버와 클라이언트 사이의 모든 통신 내용이 암호화**</u>된다.

## SSL (Secure Socket Layer)

HTTPS는 SSL(Secure Socket Layer)이나 TLS(Transport Layer Security) 프로토콜을 통해 주고 받는 데이터를 암호화하며, 기본 TCP/IP 포트는 443이고, SSL 프로토콜 위에서 HTTP 프로토콜이 동작한다.

### SSL의 암호화 방식

SSL은 공개 키 암호화 방식과 대칭 키 암호화 방식을 사용한다. 공개 키 방식으로 대칭 키를 전달하고, 서로 공유된 대칭 키를 가지고 통신하게 된다.

또한, 대칭 키는 사용 후 폐기한다.

> ### 공개 키 방식
>
> ![alt text](https://velog.velcdn.com/images%2Fcchloe2311%2Fpost%2F64ed8264-a9e1-40ea-bee2-e12366cf5293%2Fimage.png)
>
> - A키로 암호화를 하면 B키로 복호화를 할 수 있다.
>
> - B키로 암호화를 하면 A키로 복호화를 할 수 있다.
>
> - 둘 중 하나의 키를 개인 키(Private Key)라고 하며, 이는 자신만 가지고 있고 공개되지 않는다.
>
> - 나머지 하나의 키를 공개 키(Public Key)라고 하며, 공개 키는 유출되어도 개인 키를 모른다면 복호화할 수 없기 때문에 안전하다.
>   <br/> > <br/>

> ### 대칭 키 방식
>
> ![alt text](https://blog.kakaocdn.net/dn/dd4UHB/btraVqhyda9/Koiw2rKp2yVdJWiLBthiDk/img.png)
>
> - 동일한 키로 암호화, 복호화가 가능하다.
>
> - 대칭 키는 매번 생성되어 유출되어도 다음에 사용할 때는 다른 키가 생성되므로 안전하다.
>
> - 공개 키 보다 빠르게 통신할 수 있다.
>   <br/> > <br/>

### SSL 인증서

이러한 SSL 방식을 적용하려면 인증서를 발급받아 서버에 적용시켜야한다.

SSL 인증서는 **클라이언트와 서버 간의 통신을 공인된 제 3자(CA)가 보장해주는 전자화된 문서**이다.

SSL 인증서는 통신 내용이 노출, 변경되는 것을 방지하며, 클라이언트가 접속하려는 서버가 신뢰할 수 있는 서버인지 확인가능하게 해준다.

또한, SSL 통신에 사용할 공개 키를 클라이언트에게 제공한다.

### SSL 동작 과정

![alt text](https://i.imgur.com/YIfy1wK.png)

암호화된 HTTP 메세지를 교환하기 전 클라이언트와 서버는 `SSL 핸드쉐이크`를 진행한다.

`SSL 핸드쉐이크`의 목적은 다음과 같다.

- 프로토콜 버전번호 교환

- 양쪽이 알고 있는 `pre master secret` 키 생성 및 교환

- 양쪽의 신원 인증

- 채널을 암호화하기 위한 임시 세션 키 생성

#### 동작 과정

1. 클라이언트가 서버에 접속하기 위해 클라이언트가 **생성한 랜덤 데이터(1)를 서버에 보낸다.**

2. 서버는 클라이언트에게 **서버가 생성한 랜덤 데이터(2)와 CA에서 발급받은 인증서를 보낸다.** (인증서가 필요한 이유는 서버가 신뢰할 만한 서버인지 확인하기 위함이다.)

3. 클라이언트는 인증서를 받아 CA의 공개키로 복호화한다. 인증서를 복호화하면 **접속하려는 사이트의 정보와 사이트의 공개키가 들어있다.**

4. 랜덤 데이터(1)과 랜덤 데이터(2)를 조합하여 대칭 키로 사용한다. 이 때, 대칭 키를 탈취당하면 안되기 때문에 인증서에 들어있던 공개 키로 암호화하여 서버에 전송한다.

5. 서버는 가지고 있는 비밀 키를 이용해 복호화하여 클라이언트가 보낸 대칭 키를 얻는다.

6. 이후 대칭 키를 통해 데이터를 주고 받는다.

7. 세션이 종료되면 대칭 키를 폐기한다.

## 출처

- https://velog.io/@gotaek/HTTPS%EB%9E%80
- https://wayhome25.github.io/cs/2018/03/11/ssl-https/
- https://rachel-kwak.github.io/2021/03/08/HTTPS.html
